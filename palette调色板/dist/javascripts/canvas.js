define(["exports"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),s={size:2,backgroundColor:"#fff"},a=!/(iPhone|iPad|iPod|iOS|Android|SymbianOS|Windows Phone)/i.test(navigator.userAgent),h={down:a?"mousedown":"touchstart",up:a?"mouseup":"touchend",move:a?"mousemove":"touchmove",cancel:a?"mouseleave":"touchcancel"};console.log(h);var n=function(){function t(i,a){e(this,t),Object.assign(this,s,a),this.elem=document.getElementById(i),this.wrap=this.elem.parentNode,this.ctx=this.elem.getContext("2d"),this.width=this.elem.width=this.elem.offsetWidth,this.height=this.elem.height=this.elem.offsetHeight,this.elem.classList.remove("full"),this.getBound(),this.setBackgroundColor(),this.createMask(),this.trashCanvas(),this.bindEvent(),this.clear=this.clear,this.color=a.color}return i(t,[{key:"getBound",value:function(){this.left=this.elem.getBoundingClientRect().left,this.top=this.elem.getBoundingClientRect().top}},{key:"setBackgroundColor",value:function(){this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(0,0,this.width,this.height)}},{key:"bindEvent",value:function(){var t=this;this.mask.addEventListener(h.down,function(e){a||(e=e.targetTouches[0]),t.flag=!0,t.lastX=e.clientX,t.lastY=e.clientY,t.ctx.drawImage(t.mask,0,0),t.maskCtx.clearRect(0,0,t.width,t.height)}),this.mask.addEventListener(h.move,function(e){if(a||(e=e.targetTouches[0]),!t.flag)return!1;var i=e.clientX,s=e.clientY;t.draw(i,s)}),this.mask.addEventListener(h.up,function(e){a||(e=e.targetTouches[0]),t.flag=!1,t.clearFlag=!1}),this.wrap.addEventListener(h.cancel,function(e){a||(e=e.targetTouches[0]),t.flag=!1,t.clearFlag=!1})}},{key:"createMask",value:function(){this.mask=document.createElement("canvas"),this.mask.className="canvas-mask",this.maskCtx=this.mask.getContext("2d"),this.mask.width=this.width,this.mask.height=this.height,document.querySelector(".canvas-wrap").appendChild(this.mask)}},{key:"trashCanvas",value:function(){this.trashCanvas=document.createElement("canvas"),this.trashCanvasCtx=this.trashCanvas.getContext("2d"),this.trashCanvas.width=this.width,this.trashCanvas.height=this.height}},{key:"draw",value:function(t,e){this.maskCtx.beginPath(),this.maskCtx.strokeStyle=this.color,this.maskCtx.lineWidth=this.size,this.maskCtx.lineJoin="round",this.maskCtx.moveTo(this.lastX,this.lastY),this.maskCtx.lineTo(t,e),this.maskCtx.closePath(),this.maskCtx.stroke(),this.lastX=t,this.lastY=e}},{key:"repeal",value:function(){this.clearFlag&&this.ctx.drawImage(this.trashCanvas,0,0),this.maskCtx.clearRect(0,0,this.width,this.height)}},{key:"clear",value:function(){this.clearFlag=!0,this.trashCanvasCtx.drawImage(this.elem,0,0),this.trashCanvasCtx.drawImage(this.mask,0,0),this.maskCtx.clearRect(0,0,this.width,this.height),this.ctx.clearRect(0,0,this.width,this.height),this.setBackgroundColor(),this.img&&this.ctx.drawImage(this.img,0,0)}},{key:"loadImg",value:function(t){var e=this;this.clear(),this.img=new Image,this.img.onload=function(){e.trashCanvas.width=e.mask.width=e.width=e.elem.width=e.img.width,e.trashCanvas.height=e.mask.height=e.height=e.elem.height=e.img.height,e.ctx.drawImage(e.img,0,0),e.getBound()},this.img.src=t}},{key:"saveImg",value:function(){this.ctx.drawImage(this.mask,0,0),window.open(this.elem.toDataURL())}}]),t}();t["default"]=n});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhcy5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJleHBvcnRzIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsIl9kZWZhdWx0Iiwic2l6ZSIsImJhY2tncm91bmRDb2xvciIsImlzUEMiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiZXZlbnRUeXBlIiwiZG93biIsInVwIiwibW92ZSIsImNhbmNlbCIsImNvbnNvbGUiLCJsb2ciLCJQYXJ0aWNsZSIsImlkIiwib3B0aW9uIiwidGhpcyIsImFzc2lnbiIsImVsZW0iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwid3JhcCIsInBhcmVudE5vZGUiLCJjdHgiLCJnZXRDb250ZXh0Iiwid2lkdGgiLCJvZmZzZXRXaWR0aCIsImhlaWdodCIsIm9mZnNldEhlaWdodCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImdldEJvdW5kIiwic2V0QmFja2dyb3VuZENvbG9yIiwiY3JlYXRlTWFzayIsInRyYXNoQ2FudmFzIiwiYmluZEV2ZW50IiwiY2xlYXIiLCJjb2xvciIsImxlZnQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsIl90aGlzIiwibWFzayIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGFyZ2V0VG91Y2hlcyIsImZsYWciLCJsYXN0WCIsImNsaWVudFgiLCJsYXN0WSIsImNsaWVudFkiLCJkcmF3SW1hZ2UiLCJtYXNrQ3R4IiwiY2xlYXJSZWN0IiwieCIsInkiLCJkcmF3IiwiY2xlYXJGbGFnIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsInRyYXNoQ2FudmFzQ3R4IiwiYmVnaW5QYXRoIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJsaW5lSm9pbiIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlUGF0aCIsInN0cm9rZSIsImltZyIsInNyYyIsIl90aGlzMiIsIkltYWdlIiwib25sb2FkIiwid2luZG93Iiwib3BlbiIsInRvRGF0YVVSTCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQVEsV0FBWSxTQUFVQyxHQUE5QixZQU9DLFNBQVNDLEdBQWdCQyxFQUFVQyxHQUNsQyxLQUFNRCxZQUFvQkMsSUFDekIsS0FBTSxJQUFJQyxXQUFVLHFDQU50QkMsT0FBT0MsZUFBZU4sRUFBUyxjQUM5Qk8sT0FBTyxHQVNSLElBQUlDLEdBQWUsV0FDbEIsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQ2pDLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQ3RDLEdBQUlFLEdBQWFILEVBQU1DLEVBQ3ZCRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQ2pERCxFQUFXRSxjQUFlLEVBQ3RCLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FDakRaLE9BQU9DLGVBQWVJLEVBQVFJLEVBQVdJLElBQUtKLElBSWhELE1BQU8sVUFBVVgsRUFBYWdCLEVBQVlDLEdBR3pDLE1BRklELElBQVlWLEVBQWlCTixFQUFZa0IsVUFBV0YsR0FDcERDLEdBQWFYLEVBQWlCTixFQUFhaUIsR0FDeENqQixNQXpCSm1CLEdBQ0xDLEtBQU0sRUFDTkMsZ0JBQWlCLFFBR1pDLEdBQVEsMERBQTBEQyxLQUFLQyxVQUFVQyxXQUVqRkMsR0FDTEMsS0FBTUwsRUFBTyxZQUFjLGFBQzNCTSxHQUFJTixFQUFPLFVBQVksV0FDdkJPLEtBQU1QLEVBQU8sWUFBYyxZQUMzQlEsT0FBUVIsRUFBTyxhQUFlLGNB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LEVBQUt6QyxZQUFZVCxNQUFRa0QsRUFBSy9CLEtBQUtuQixNQUFRa0QsRUFBS2xELE1BQVFrRCxFQUFLekQsS0FBS08sTUFBUWtELEVBQUtGLElBQUloRCxNQUNuRmtELEVBQUt6QyxZQUFZUCxPQUFTZ0QsRUFBSy9CLEtBQUtqQixPQUFTZ0QsRUFBS2hELE9BQVNnRCxFQUFLekQsS0FBS1MsT0FBU2dELEVBQUtGLElBQUk5QyxPQUN2RmdELEVBQUtwRCxJQUFJOEIsVUFBVXNCLEVBQUtGLElBQUssRUFBRyxHQUNoQ0UsRUFBSzVDLFlBRU5mLEtBQUt5RCxJQUFJQyxJQUFNQSxLQXlEZC9FLElBQUssVUFDTFgsTUFBTyxXQXZEUmdDLEtBQUtPLElBQUk4QixVQUFVckMsS0FBSzRCLEtBQU0sRUFBRyxHQUNqQ2tDLE9BQU9DLEtBQUsvRCxLQUFLRSxLQUFLOEQsaUJBNERmbkUsSUFHUnBDLEdBQUFBLFdBdExvQm9DIiwiZmlsZSI6ImNhbnZhcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IF9kZWZhdWx0ID0ge1xyXG5cdHNpemU6IDIsXHJcblx0YmFja2dyb3VuZENvbG9yOiAnI2ZmZidcclxufVxyXG5cclxuY29uc3QgaXNQQyA9ICEvKGlQaG9uZXxpUGFkfGlQb2R8aU9TfEFuZHJvaWR8U3ltYmlhbk9TfFdpbmRvd3MgUGhvbmUpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KVxyXG5cclxuY29uc3QgZXZlbnRUeXBlID0ge1xyXG5cdGRvd246IGlzUEMgPyAnbW91c2Vkb3duJyA6ICd0b3VjaHN0YXJ0JyxcclxuXHR1cDogaXNQQyA/ICdtb3VzZXVwJyA6ICd0b3VjaGVuZCcsXHJcblx0bW92ZTogaXNQQyA/ICdtb3VzZW1vdmUnIDogJ3RvdWNobW92ZScsXHJcblx0Y2FuY2VsOiBpc1BDID8gJ21vdXNlbGVhdmUnIDogJ3RvdWNoY2FuY2VsJyxcclxufVxyXG5cclxuY29uc29sZS5sb2coZXZlbnRUeXBlKVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFydGljbGUge1xyXG5cdGNvbnN0cnVjdG9yKGlkLCBvcHRpb24pIHtcclxuXHRcdE9iamVjdC5hc3NpZ24odGhpcywgX2RlZmF1bHQsIG9wdGlvbik7XHJcblx0XHR0aGlzLmVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcblx0XHR0aGlzLndyYXAgPSB0aGlzLmVsZW0ucGFyZW50Tm9kZTtcclxuXHRcdHRoaXMuY3R4ID0gdGhpcy5lbGVtLmdldENvbnRleHQoJzJkJyk7XHJcblx0XHR0aGlzLndpZHRoID0gdGhpcy5lbGVtLndpZHRoID0gdGhpcy5lbGVtLm9mZnNldFdpZHRoO1xyXG5cdFx0dGhpcy5oZWlnaHQgPSB0aGlzLmVsZW0uaGVpZ2h0ID0gdGhpcy5lbGVtLm9mZnNldEhlaWdodDtcclxuXHRcdHRoaXMuZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdmdWxsJyk7XHJcblx0XHR0aGlzLmdldEJvdW5kKCk7XHJcblx0XHR0aGlzLnNldEJhY2tncm91bmRDb2xvcigpO1xyXG5cdFx0dGhpcy5jcmVhdGVNYXNrKCk7XHJcblx0XHR0aGlzLnRyYXNoQ2FudmFzKCk7XHJcblx0XHR0aGlzLmJpbmRFdmVudCgpO1xyXG5cdFx0dGhpcy5jbGVhciA9IHRoaXMuY2xlYXI7XHJcblxyXG5cdFx0dGhpcy5jb2xvciA9IG9wdGlvbi5jb2xvcjtcclxuXHR9XHJcblx0Z2V0Qm91bmQoKSB7XHJcblx0XHR0aGlzLmxlZnQgPSB0aGlzLmVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcclxuXHRcdHRoaXMudG9wID0gdGhpcy5lbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuXHR9XHJcblx0c2V0QmFja2dyb3VuZENvbG9yKCkge1xyXG5cdFx0dGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5iYWNrZ3JvdW5kQ29sb3I7XHJcblx0XHR0aGlzLmN0eC5maWxsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcblx0fVxyXG5cdGJpbmRFdmVudCgpIHtcclxuXHRcdHRoaXMubWFzay5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZVsnZG93biddLCAoZSkgPT4ge1xyXG5cdFx0XHRpZiAoIWlzUEMpIHtcclxuXHRcdFx0XHRlID0gZS50YXJnZXRUb3VjaGVzWzBdXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuZmxhZyA9IHRydWU7XHJcblx0XHRcdHRoaXMubGFzdFggPSBlLmNsaWVudFg7XHJcblx0XHRcdHRoaXMubGFzdFkgPSBlLmNsaWVudFk7XHJcblx0XHRcdHRoaXMuY3R4LmRyYXdJbWFnZSh0aGlzLm1hc2ssIDAsIDApO1xyXG5cdFx0XHR0aGlzLm1hc2tDdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuXHRcdH0pXHJcblx0XHR0aGlzLm1hc2suYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGVbJ21vdmUnXSwgKGUpID0+IHtcclxuXHRcdFx0aWYgKCFpc1BDKSB7XHJcblx0XHRcdFx0ZSA9IGUudGFyZ2V0VG91Y2hlc1swXVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuZmxhZykgcmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRsZXQgeCA9IGUuY2xpZW50WDtcclxuXHRcdFx0bGV0IHkgPSBlLmNsaWVudFk7XHJcblx0XHRcdHRoaXMuZHJhdyh4LCB5KTtcclxuXHRcdH0pXHJcblx0XHR0aGlzLm1hc2suYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGVbJ3VwJ10sIChlKSA9PiB7XHJcblx0XHRcdGlmICghaXNQQykge1xyXG5cdFx0XHRcdGUgPSBlLnRhcmdldFRvdWNoZXNbMF1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5mbGFnID0gZmFsc2U7XHJcblx0XHRcdHRoaXMuY2xlYXJGbGFnID0gZmFsc2U7XHJcblx0XHR9KVxyXG5cdFx0dGhpcy53cmFwLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlWydjYW5jZWwnXSwgKGUpID0+IHtcclxuXHRcdFx0aWYgKCFpc1BDKSB7XHJcblx0XHRcdFx0ZSA9IGUudGFyZ2V0VG91Y2hlc1swXVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLmZsYWcgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5jbGVhckZsYWcgPSBmYWxzZTtcclxuXHRcdH0pXHJcblx0fVxyXG5cdGNyZWF0ZU1hc2soKSB7XHJcblx0XHR0aGlzLm1hc2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuXHRcdHRoaXMubWFzay5jbGFzc05hbWUgPSAnY2FudmFzLW1hc2snO1xyXG5cdFx0dGhpcy5tYXNrQ3R4ID0gdGhpcy5tYXNrLmdldENvbnRleHQoJzJkJyk7XHJcblx0XHR0aGlzLm1hc2sud2lkdGggPSB0aGlzLndpZHRoO1xyXG5cdFx0dGhpcy5tYXNrLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xyXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhbnZhcy13cmFwJykuYXBwZW5kQ2hpbGQodGhpcy5tYXNrKTtcclxuXHR9XHJcblx0dHJhc2hDYW52YXMoKSB7XHJcblx0XHR0aGlzLnRyYXNoQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcblx0XHR0aGlzLnRyYXNoQ2FudmFzQ3R4ID0gdGhpcy50cmFzaENhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG5cdFx0dGhpcy50cmFzaENhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XHJcblx0XHR0aGlzLnRyYXNoQ2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xyXG5cdH1cclxuXHRkcmF3KHgsIHkpIHtcclxuXHRcdHRoaXMubWFza0N0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICB0aGlzLm1hc2tDdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yO1xyXG4gICAgICAgIHRoaXMubWFza0N0eC5saW5lV2lkdGggPSB0aGlzLnNpemU7XHJcbiAgICAgICAgdGhpcy5tYXNrQ3R4LmxpbmVKb2luID0gXCJyb3VuZFwiO1xyXG4gICAgICAgIHRoaXMubWFza0N0eC5tb3ZlVG8odGhpcy5sYXN0WCwgdGhpcy5sYXN0WSk7XHJcbiAgICAgICAgdGhpcy5tYXNrQ3R4LmxpbmVUbyh4LCB5KTtcclxuICAgICAgICB0aGlzLm1hc2tDdHguY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgdGhpcy5tYXNrQ3R4LnN0cm9rZSgpO1xyXG4gICAgICAgIHRoaXMubGFzdFggPSB4O1xyXG4gICAgICAgIHRoaXMubGFzdFkgPSB5O1xyXG5cdH1cclxuXHRyZXBlYWwoKSB7XHJcblx0XHR0aGlzLmNsZWFyRmxhZyAmJiB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy50cmFzaENhbnZhcywgMCwgMCk7XHJcblx0XHR0aGlzLm1hc2tDdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuXHR9XHJcblx0Y2xlYXIoKSB7XHJcblx0XHR0aGlzLmNsZWFyRmxhZyA9IHRydWU7XHJcblx0XHR0aGlzLnRyYXNoQ2FudmFzQ3R4LmRyYXdJbWFnZSh0aGlzLmVsZW0sIDAsIDApO1xyXG5cdFx0dGhpcy50cmFzaENhbnZhc0N0eC5kcmF3SW1hZ2UodGhpcy5tYXNrLCAwLCAwKTtcclxuXHRcdHRoaXMubWFza0N0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG5cdFx0dGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuXHRcdHRoaXMuc2V0QmFja2dyb3VuZENvbG9yKCk7XHJcblx0XHRpZiAodGhpcy5pbWcpIHtcclxuXHRcdFx0dGhpcy5jdHguZHJhd0ltYWdlKHRoaXMuaW1nLCAwLCAwKTtcclxuXHRcdH1cclxuXHR9XHJcblx0bG9hZEltZyhzcmMpIHtcclxuXHRcdHRoaXMuY2xlYXIoKTtcclxuXHRcdHRoaXMuaW1nID0gbmV3IEltYWdlKClcclxuXHRcdHRoaXMuaW1nLm9ubG9hZCA9ICgpID0+IHtcclxuXHRcdFx0dGhpcy50cmFzaENhbnZhcy53aWR0aCA9IHRoaXMubWFzay53aWR0aCA9IHRoaXMud2lkdGggPSB0aGlzLmVsZW0ud2lkdGggPSB0aGlzLmltZy53aWR0aDtcclxuXHRcdFx0dGhpcy50cmFzaENhbnZhcy5oZWlnaHQgPSB0aGlzLm1hc2suaGVpZ2h0ID0gdGhpcy5oZWlnaHQgPSB0aGlzLmVsZW0uaGVpZ2h0ID0gdGhpcy5pbWcuaGVpZ2h0O1xyXG5cdFx0XHR0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy5pbWcsIDAsIDApO1xyXG5cdFx0XHR0aGlzLmdldEJvdW5kKCk7XHJcblx0XHR9XHJcblx0XHR0aGlzLmltZy5zcmMgPSBzcmNcclxuXHR9XHJcblx0c2F2ZUltZygpIHtcclxuXHRcdHRoaXMuY3R4LmRyYXdJbWFnZSh0aGlzLm1hc2ssIDAsIDApO1xyXG5cdFx0d2luZG93Lm9wZW4odGhpcy5lbGVtLnRvRGF0YVVSTCgpKTtcclxuXHR9XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
